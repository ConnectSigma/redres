<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>redres: Redress Your Mixed Model Assumptions • redres</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="redres: Redress Your Mixed Model Assumptions">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">redres</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/redres-vignette.html">redres: Redress Your Mixed Model Assumptions</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/goodekat/redres.git">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>redres: Redress Your Mixed Model Assumptions</h1>
                        <h4 class="author">R Package Version 0.1.0.9</h4>
            
            <h4 class="date">2019-04-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/goodekat/redres.git/blob/master/vignettes/redres-vignette.Rmd"><code>vignettes/redres-vignette.Rmd</code></a></small>
      <div class="hidden name"><code>redres-vignette.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>The Merriam-Webster dictionary defines <a href="https://www.merriam-webster.com/dictionary/redress">redress</a> as “to set right”.</p>
<p>The package can be installed from GitHub using devtools and then loaded in the normal way.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Installs redres from GitHub</span>
devtools<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/devtools/topics/reexports">install_github</a></span>(<span class="st">"goodekat/redres"</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Loads the package</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(redres)</code></pre></div>
</div>
<div id="package-functions" class="section level1">
<h1 class="hasAnchor">
<a href="#package-functions" class="anchor"></a>Package Functions</h1>
<p><code>redres</code> contains various functions that provide different ways to assess model assumptions for linear mixed models fit using <code>lmer</code>. The function range from returning a vector of residuals to be used by the user as desired to opening a Shiny app that allows the user to interactively assess the model with package provided tools. A brief description of each function is listed below.</p>
<ul>
<li>
<a href="#redres">redres</a>: computes and returns residuals given a model and a specified residual type</li>
<li>
<a href="#plot_redres">plot_redres</a>: creates a plot of residuals versus fitted values for a given residual type</li>
<li>
<a href="#plot_resqq">plot_resqq</a>: creates a normal quantile plot for conditional residuals</li>
<li>
<a href="#plot_raneff">plot_raneff</a>: creates a normal quantile plot for the random effects</li>
<li>
<a href="#redres_app">redres_app</a>: opens an interactive Shiny app with</li>
</ul>
<p>Each of these functions has a subsection below that describes in further detail what the function does, how to use it, and how to interpret the output. The functions will be demenstrated using the data <code>sleepstudy</code> from the <code>lme4</code> package and the linear mixed effects models fit in the code below called <code>fm1</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Loads the lme4 libraries</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(lme4)
<span class="co">#&gt; Loading required package: Matrix</span>

<span class="co"># Prints the first 6 rows of the sleepstudy data</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(sleepstudy)
<span class="co">#&gt;   Reaction Days Subject</span>
<span class="co">#&gt; 1 249.5600    0     308</span>
<span class="co">#&gt; 2 258.7047    1     308</span>
<span class="co">#&gt; 3 250.8006    2     308</span>
<span class="co">#&gt; 4 321.4398    3     308</span>
<span class="co">#&gt; 5 356.8519    4     308</span>
<span class="co">#&gt; 6 414.6901    5     308</span>

<span class="co"># Fits a linear mixed effects model to the sleepstudy data</span>
(m &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/lme4/topics/lmer">lmer</a></span>(Reaction <span class="op">~</span><span class="st"> </span>Days <span class="op">+</span><span class="st"> </span>(Days<span class="op">|</span>Subject), sleepstudy))
<span class="co">#&gt; Linear mixed model fit by REML ['lmerMod']</span>
<span class="co">#&gt; Formula: Reaction ~ Days + (Days | Subject)</span>
<span class="co">#&gt;    Data: sleepstudy</span>
<span class="co">#&gt; REML criterion at convergence: 1743.628</span>
<span class="co">#&gt; Random effects:</span>
<span class="co">#&gt;  Groups   Name        Std.Dev. Corr</span>
<span class="co">#&gt;  Subject  (Intercept) 24.737       </span>
<span class="co">#&gt;           Days         5.923   0.07</span>
<span class="co">#&gt;  Residual             25.592       </span>
<span class="co">#&gt; Number of obs: 180, groups:  Subject, 18</span>
<span class="co">#&gt; Fixed Effects:</span>
<span class="co">#&gt; (Intercept)         Days  </span>
<span class="co">#&gt;      251.41        10.47</span></code></pre></div>
<div id="redres" class="section level2">
<h2 class="hasAnchor">
<a href="#redres" class="anchor"></a>redres</h2>
<p>The function <code>redres</code> app can be used to compute a handful of residual types for models fit using <code>lmer</code> including some not available through <code>lme4</code>.</p>
<p><strong>Inputs</strong></p>
<ul>
<li>
<code>model</code>: A model fit using <code>lmer</code> for which the residuals will be computed.</li>
<li>
<code>type</code>: A character string identifying the type of residual that will be computed. By default, the raw conditional residuals are returned. The following are the options available for type.
<ul>
<li>
<code>"pearson_cond"</code>: Pearson conditional residuals</li>
<li>
<code>"pearson_mar"</code>: Pearson marginal residuals</li>
<li>
<code>"raw_cond"</code>: raw conditional residuals (default)</li>
<li>
<code>"raw_mar"</code>: raw marginal residuals</li>
<li>
<code>"std_cond"</code>: studentized conditional residuals</li>
<li>
<code>"std_mar"</code>: studentized marginal residuals</li>
</ul>
</li>
</ul>
<p>See the section on <a href="#types">residual types</a> for details on how the residuals are computed and their purpose.</p>
<p><strong>Output</strong></p>
<ul>
<li>
<code>redres</code> returns a vector of residuals according to the type specified in the order that the data observations are input into <code>lmer</code>.</li>
</ul>
<p><strong>Functionality</strong></p>
<p>The code below demonstrates the use of <code>redres</code> to compute several types of residuals from the model <code>m</code>. These residuals are put into a dataframe and joined with the <code>sleepstudy</code> data. The user can then use these residuals as desired.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Computes the default residuals (raw conditional)</span>
rcr &lt;-<span class="st"> </span><span class="kw"><a href="../reference/redres.html">redres</a></span>(m)

<span class="co"># Computes the Pearson marginal residuals</span>
pmr &lt;-<span class="st"> </span><span class="kw"><a href="../reference/redres.html">redres</a></span>(m, <span class="dt">type =</span> <span class="st">"pearson_mar"</span>)

<span class="co"># Computes the studentized conditional residuals</span>
scr &lt;-<span class="st"> </span><span class="kw"><a href="../reference/redres.html">redres</a></span>(m, <span class="dt">type =</span> <span class="st">"std_cond"</span>)

<span class="co"># Joins the residuals to the sleepstudy data</span>
sleepstudy_plus &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(sleepstudy, rcr, pmr, scr)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(sleepstudy_plus)
<span class="co">#&gt;   Reaction Days Subject        rcr         pmr        scr</span>
<span class="co">#&gt; 1 249.5600    0     308  -4.102638 -0.05183946 -0.1827204</span>
<span class="co">#&gt; 2 258.7047    1     308 -14.624497 -0.08779115 -0.6273252</span>
<span class="co">#&gt; 3 250.8006    2     308 -42.195157 -0.57418908 -1.7645439</span>
<span class="co">#&gt; 4 321.4398    3     308   8.777483  0.97112562  0.3616111</span>
<span class="co">#&gt; 5 356.8519    4     308  24.523024  1.48696343  1.0048545</span>
<span class="co">#&gt; 6 414.6901    5     308  62.694664  2.39619943  2.5789296</span></code></pre></div>
</div>
<div id="plot_redres" class="section level2">
<h2 class="hasAnchor">
<a href="#plot_redres" class="anchor"></a>plot_redres</h2>
<p>The function <code>plot_redres</code> is included in the package to allow for the easy creation of a residual plot using <code>ggplot2</code> for a linear mixed model fit using <code>lmer</code>. <code>plot_redres</code> allows the user to specify any residual type to be plotted on the y-axis including those not provided by <code>lme4</code>.</p>
<p><strong>Inputs</strong></p>
<ul>
<li>
<code>model</code>: A model fit using <code>lmer</code> for which the residuals will be computed.</li>
<li>
<code>type</code>: A character string identifying the type of residual that will be computed. The same options available with <a href="#redres"><code>redres</code></a> are available for <code>plot_redres</code>. By default, the conditional raw residuals are plotted.</li>
</ul>
<p><strong>Output</strong></p>
<ul>
<li>A <code>ggplot2</code> object of a scatterplot of the model residuals of the type specified versus the fitted values is created.</li>
</ul>
<p><strong>Functionality</strong></p>
<p>The code below shows how to create the most basic plot using <code>plot_redres</code>. By inputing the model <code>m</code>, a plot of the conditional raw residuals versus the fitted values is returned.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Creates the default residual plot</span>
<span class="kw"><a href="../reference/plot_redres.html">plot_redres</a></span>(m)</code></pre></div>
<p><img src="redres-vignette_files/figure-html/unnamed-chunk-5-1.png" width="480" style="display: block; margin: auto;"></p>
<p>The type of residuals can be changed using the <code>type</code> option as shown in the code below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Creates the residual plot with studentized marginal residuals</span>
<span class="kw"><a href="../reference/plot_redres.html">plot_redres</a></span>(m, <span class="dt">type =</span> <span class="st">"std_mar"</span>)</code></pre></div>
<p><img src="redres-vignette_files/figure-html/unnamed-chunk-6-1.png" width="480" style="display: block; margin: auto;"></p>
<p>All plots created using the <code>redres</code> package are formatted to use <code>theme_bw</code> from <code>ggplot2</code>. However, since <code>plot_redres</code> returns a ggplot object, it is possible to use functions provided by <code>ggplot2</code> adjust the formatting of the plot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Applies ggplot2 formatting functions to the output from plot_resid</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2)
<span class="kw"><a href="../reference/plot_redres.html">plot_redres</a></span>(m, <span class="dt">type =</span> <span class="st">"pearson_cond"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_classic</a></span>() <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/labs">labs</a></span>(<span class="dt">title =</span> <span class="st">"Residual Plot"</span>)</code></pre></div>
<p><img src="redres-vignette_files/figure-html/unnamed-chunk-7-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div id="plot_resqq" class="section level2">
<h2 class="hasAnchor">
<a href="#plot_resqq" class="anchor"></a>plot_resqq</h2>
</div>
<div id="plot_ranef" class="section level2">
<h2 class="hasAnchor">
<a href="#plot_ranef" class="anchor"></a>plot_ranef</h2>
<div id="quantile-plots" class="section level3">
<h3 class="hasAnchor">
<a href="#quantile-plots" class="anchor"></a>Quantile plots</h3>
<p>Quantile plots are used to verify visually if data follows are particular distribution. Data points are plotted along the quantiles of the assumed distributed. The data is expected to follow an approximately straight line, at least along the middle quantiles. The points are assessed for any extreme curvation that would indicate a departure from the assumed distribution. Typically curvature at the extreme ends of the quantiles (around 0 and 1) are ignored as data is sparse here and distributions behave more erratically at the boundaries of the parameter space. We have added confidence bands to guide the user.</p>
<p>The function <code>plot_ranef</code> plots each random effect vector along the normal quantiles. From the assumptions of the linear mixed model, each random effect specified - along with the error term - is assumed to follow a normal distribution. Therefore, these plots can be used to assess if this assumption is met. Note that the number of plots generated by this function will vary for each model, with the number of plots being the number of random effects.</p>
</div>
</div>
<div id="redres_app" class="section level2">
<h2 class="hasAnchor">
<a href="#redres_app" class="anchor"></a>redres_app</h2>
</div>
</div>
<div id="types" class="section level1">
<h1 class="hasAnchor">
<a href="#types" class="anchor"></a>Residual Types</h1>
<p>Section on how to compute the different residual types and when to use them…</p>
<p>The linear mixed effects model can be written as <span class="math display">\[\textbf{Y}=\textbf{X}\boldsymbol{\beta}+\textbf{Z}\boldsymbol{\gamma}+\boldsymbol{\epsilon}\]</span> where</p>
<ul>
<li>
<span class="math inline">\(\textbf{Y}\)</span> is an <span class="math inline">\(n\times 1\)</span> vector of <span class="math inline">\(n\)</span> response variable observations,</li>
<li>
<span class="math inline">\(\textbf{X}\)</span> is an <span class="math inline">\(n\times p\)</span> matrix of <span class="math inline">\(p\)</span> explanatory variables with <span class="math inline">\(n\)</span> observations each,</li>
<li>
<span class="math inline">\(\boldsymbol{\beta}\)</span> is a <span class="math inline">\(p\times1\)</span> vector of unknown fixed effects parameters,</li>
<li>
<span class="math inline">\(\textbf{Z}\)</span> is an <span class="math inline">\(n\times q\)</span> matrix of <span class="math inline">\(q\)</span> random effect variables with <span class="math inline">\(n\)</span> observations each,</li>
<li>
<span class="math inline">\(\boldsymbol{\gamma}\)</span> is a <span class="math inline">\(q\times1\)</span> vector of unknown random effects, and</li>
<li>
<span class="math inline">\(\boldsymbol{\epsilon}\)</span> is an <span class="math inline">\(n\times1\)</span> vector of random errors.</li>
</ul>
<p>By assumption, it is the case that… <span class="math display">\[ 
\begin{bmatrix} \boldsymbol{\gamma} \\ \boldsymbol{\epsilon} \end{bmatrix}
  \sim N 
    \begin{pmatrix} 
      \begin{bmatrix} \boldsymbol{0} \\ \boldsymbol{0} \end{bmatrix},
      \begin{bmatrix} \textbf{G} &amp; \boldsymbol{0} \\ \boldsymbol{0} &amp; \textbf{R} \end{bmatrix}
    \end{pmatrix}
\]</span></p>
<div id="raw" class="section level2">
<h2 class="hasAnchor">
<a href="#raw" class="anchor"></a>Raw</h2>
<ul>
<li>marginal: <span class="math display">\[\textbf{r}^m_i = Y_i-\textbf{x}'_i\hat{\boldsymbol{\beta}}\]</span>
</li>
<li>conditional: <span class="math display">\[\textbf{r}^c_i = Y_i-\textbf{x}'_i\hat{\boldsymbol{\beta}}-\textbf{z}'_i\hat{\boldsymbol{\gamma}}\]</span>
</li>
</ul>
</div>
<div id="pearson" class="section level2">
<h2 class="hasAnchor">
<a href="#pearson" class="anchor"></a>Pearson</h2>
<ul>
<li>marginal: <span class="math display">\[\textbf{r}^{m,pearson}_{i} = \frac{r^m_i}{\sqrt{\hat{Var[Y_i]}}}\]</span>
</li>
<li>conditional: <span class="math display">\[\textbf{r}^{c,pearson}_{i} = \frac{r^m_i}{\sqrt{\hat{Var[Y_i|\boldsymbol{\gamma}]}}}\]</span>
</li>
</ul>
</div>
<div id="studentized" class="section level2">
<h2 class="hasAnchor">
<a href="#studentized" class="anchor"></a>Studentized</h2>
<ul>
<li>marginal:</li>
<li>conditional:</li>
</ul>
</div>
</div>
<div id="application" class="section level1">
<h1 class="hasAnchor">
<a href="#application" class="anchor"></a>Application</h1>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li>
<a href="#package-functions">Package Functions</a><ul class="nav nav-pills nav-stacked">
<li><a href="#redres">redres</a></li>
      <li><a href="#plot_redres">plot_redres</a></li>
      <li><a href="#plot_resqq">plot_resqq</a></li>
      <li><a href="#plot_ranef">plot_ranef</a></li>
      <li><a href="#redres_app">redres_app</a></li>
      </ul>
</li>
      <li>
<a href="#types">Residual Types</a><ul class="nav nav-pills nav-stacked">
<li><a href="#raw">Raw</a></li>
      <li><a href="#pearson">Pearson</a></li>
      <li><a href="#studentized">Studentized</a></li>
      </ul>
</li>
      <li><a href="#application">Application</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Katherine Goode.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
